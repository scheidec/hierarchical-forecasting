---
title: "Hierarchical Time Series Forecasting"
author: "Caleb Scheidel"
date: "2018/11/30"
output:
  xaringan::moon_reader:
    css: ["mc-xaringan.css", "mc-xaringan-fonts.css"]
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
editor_options: 
  chunk_output_type: console
---

layout: true
background-color: #fafaef
<div class="my-footer"><img src="mc_logo_rectangle.png" style="height: 30px;"/></div>

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(forecast)
library(hts)
library(skimr)
```

---

## Motivation

- Why would we be interested in hierarchically structured time series?

---

# Forecasting

- General overview of forecasting

---

## Hierarchical Time Series

- More detail on "hierarchical" structure
  - visualize an example

---

## Optimal Combination

- Proposed by Hyndman, et al (2011)

---

## Trace Minimization

- Proposed by Hyndman, et al (2018)

---

## `hts` package



---

## Bottom-up method

- Advantage: no information is lost due to aggregation
- Disadvantage: bottom-level data can be quite noisy and more challenging to model and forecast

---

## Top-down method

- Average historical proportions
- Proportions of the historical averages
- Forecasted proportions
  - first generate _h_-step-ahead base forecasts for all the series independently
  - at level 1 we calculate the proportion of each _h_-step-ahead base forecasts

---

## Top-down method

```{r}

library(hts)

bts <- ts(5 + matrix(sort(rnorm(500)), ncol = 5, nrow = 100))

y <- hts(bts, nodes = list(2, c(3, 2)))

ally <- aggts(y)
somey <- aggts(y, levels = c(0, 2))
S <- smatrix(y)

infantforecast <- forecast(infantgts, h = 10, method = "bu")

fcasts1.td <- forecast(
  htseg1, h = 4, method = "tdfp", fmethod = "arima", keep.fitted = TRUE
)
```

---

## Top-down method

```{r}
fcasts1.td
```

---

## Middle-out method
